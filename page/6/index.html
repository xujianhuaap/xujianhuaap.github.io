<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/6/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-android-frameworks-servermanager" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/19/android-frameworks-servermanager/" class="article-date">
  <time datetime="2016-01-19T09:44:25.000Z" itemprop="datePublished">2016-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/19/android-frameworks-servermanager/">android-frameworks-servermanager</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>参考文件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">platform<span class="regexp">/base/</span>cmds<span class="regexp">/servicemanager/</span>service_manager.c</span><br><span class="line">platform<span class="regexp">/base/</span>cmds<span class="regexp">/servicemanager/</span>binder.c</span><br></pre></td></tr></table></figure>
</li>
<li><p>ServerManager.main()</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">int</span> main(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct </span><span class="keyword">binder_state </span>*<span class="keyword">bs;</span></span><br><span class="line"><span class="keyword"> </span>   void *<span class="keyword">svcmgr </span>= <span class="keyword">BINDER_SERVICE_MANAGER;</span></span><br><span class="line"><span class="keyword"> </span>   //打开<span class="keyword">binder虚拟设备,</span></span><br><span class="line"><span class="keyword"> </span>   <span class="keyword">bs </span>= <span class="keyword">binder_open(128*1024);//binder所占内存大小</span></span><br><span class="line"><span class="keyword"> </span>   //<span class="keyword">binder_become_context_manager(bs)与binder设备进行通信将自己变成Context_ServerManager</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">if</span> (<span class="keyword">binder_become_context_manager(bs)) </span>&#123;</span><br><span class="line">        LOGE(<span class="string">"cannot become context manager (%s)\n"</span>, <span class="keyword">strerror(errno));</span></span><br><span class="line"><span class="keyword"> </span>       return -<span class="number">1</span><span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">svcmgr_handle= </span><span class="keyword">svcmgr;</span></span><br><span class="line"><span class="keyword"> </span>   //检查是否有有效请求,若有将会调用<span class="keyword">svcmgr_handler</span></span><br><span class="line"><span class="keyword"> </span>   <span class="keyword">binder_loop(bs, </span><span class="keyword">svcmgr_handler);</span></span><br><span class="line"><span class="keyword"> </span>   return <span class="number">0</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在binder.h中相关的方法</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct </span><span class="keyword">binder_state</span></span><br><span class="line"><span class="keyword">&#123;</span></span><br><span class="line"><span class="keyword"> </span>   int fd<span class="comment">;</span></span><br><span class="line">    void *mapped<span class="comment">;//未确定类型的指针</span></span><br><span class="line">    unsigned mapsize<span class="comment">;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line">//打开虚拟<span class="keyword">binder设备</span></span><br><span class="line"><span class="keyword">struct </span><span class="keyword">binder_state </span>*<span class="keyword">binder_open(unsigned </span>mapsize)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct </span><span class="keyword">binder_state </span>*<span class="keyword">bs;</span></span><br><span class="line"><span class="keyword"> </span>   <span class="keyword">bs </span>= malloc(sizeof(*<span class="keyword">bs));//向系统申请分配内存(低于128k) </span>    </span><br><span class="line">    <span class="meta">if</span> (!<span class="keyword">bs) </span>&#123;</span><br><span class="line">        errno = ENOMEM<span class="comment">;</span></span><br><span class="line">        return <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    //挂载<span class="string">'/dev/binder'</span>目录</span><br><span class="line">    <span class="keyword">bs-&gt;fd </span>= open(<span class="string">"/dev/binder"</span>, O_RDWR)<span class="comment">;</span></span><br><span class="line">    <span class="meta">if</span> (<span class="keyword">bs-&gt;fd </span>&lt; <span class="number">0</span>) &#123;</span><br><span class="line">        fprintf(stderr,<span class="string">"binder: cannot open device (%s)\n"</span>,</span><br><span class="line">                <span class="keyword">strerror(errno));</span></span><br><span class="line"><span class="keyword"> </span>       goto fail_open<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    //设置<span class="keyword">bs </span>反映<span class="keyword">binder设备所占内存大小的变量mapsize</span></span><br><span class="line"><span class="keyword"> </span>   <span class="keyword">bs-&gt;mapsize </span>= mapsize<span class="comment">;</span></span><br><span class="line">    //映射内存</span><br><span class="line">    <span class="keyword">bs-&gt;mapped </span>= mmap(NULL, mapsize, PROT_READ, MAP_PRIVATE, <span class="keyword">bs-&gt;fd, </span><span class="number">0</span>)<span class="comment">;//用户进程级别申请内存</span></span><br><span class="line">    <span class="meta">if</span> (<span class="keyword">bs-&gt;mapped </span>== MAP_FAILED) &#123;</span><br><span class="line">        fprintf(stderr,<span class="string">"binder: cannot map device (%s)\n"</span>,</span><br><span class="line">                <span class="keyword">strerror(errno));</span></span><br><span class="line"><span class="keyword"> </span>       goto fail_map<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    return <span class="keyword">bs;</span></span><br><span class="line"><span class="keyword">&#125;</span></span><br><span class="line"><span class="keyword">//註冊成爲Context_Manager</span></span><br><span class="line"><span class="keyword">int </span><span class="keyword">binder_become_context_manager(struct </span><span class="keyword">binder_state </span>*<span class="keyword">bs)</span></span><br><span class="line"><span class="keyword">&#123;</span></span><br><span class="line"><span class="keyword"> </span>   return ioctl(<span class="keyword">bs-&gt;fd, </span><span class="keyword">BINDER_SET_CONTEXT_MGR, </span><span class="number">0</span>)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">//<span class="keyword">binder_handler </span>是一个回调函数</span><br><span class="line">//不断通过ioctl检查是否有请求</span><br><span class="line"><span class="symbol">void</span> <span class="keyword">binder_loop(struct </span><span class="keyword">binder_state </span>*<span class="keyword">bs, </span><span class="keyword">binder_handler </span>func)</span><br><span class="line">&#123;</span><br><span class="line">    int res<span class="comment">;</span></span><br><span class="line">    <span class="keyword">struct </span><span class="keyword">binder_write_read </span><span class="keyword">bwr;//binder设备读写数据结构</span></span><br><span class="line"><span class="keyword"> </span>   unsigned readbuf[<span class="number">32</span>]<span class="comment">;</span></span><br><span class="line">    //初始化<span class="keyword">binder设备读写数据结构</span></span><br><span class="line"><span class="keyword"> </span>   <span class="keyword">bwr.write_size </span>= <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    <span class="keyword">bwr.write_consumed </span>= <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    <span class="keyword">bwr.write_buffer </span>= <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    //设置为readbuf的首变量</span><br><span class="line">    readbuf[<span class="number">0</span>] = <span class="keyword">BC_ENTER_LOOPER;</span></span><br><span class="line"><span class="keyword"> </span>   //</span><br><span class="line">    <span class="keyword">binder_write(bs, </span>readbuf, sizeof(unsigned))<span class="comment">;</span></span><br><span class="line">    for (<span class="comment">;;) &#123;</span></span><br><span class="line">        <span class="keyword">bwr.read_size </span>= sizeof(readbuf)<span class="comment">;</span></span><br><span class="line">        <span class="keyword">bwr.read_consumed </span>= <span class="number">0</span><span class="comment">;</span></span><br><span class="line">        <span class="keyword">bwr.read_buffer </span>= (unsigned) readbuf<span class="comment">;</span></span><br><span class="line">        res = ioctl(<span class="keyword">bs-&gt;fd, </span><span class="keyword">BINDER_WRITE_READ, </span>&amp;<span class="keyword">bwr);</span></span><br><span class="line"><span class="keyword"> </span>       <span class="meta">if</span> (res &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            LOGE(<span class="string">"binder_loop: ioctl failed (%s)\n"</span>, <span class="keyword">strerror(errno));</span></span><br><span class="line"><span class="keyword"> </span>           <span class="keyword">break;</span></span><br><span class="line"><span class="keyword"> </span>       &#125;</span><br><span class="line">        //解析请求</span><br><span class="line">        res = <span class="keyword">binder_parse(bs, </span><span class="number">0</span>, readbuf, <span class="keyword">bwr.read_consumed, </span>func)<span class="comment">;</span></span><br><span class="line">        <span class="meta">if</span> (res == <span class="number">0</span>) &#123;</span><br><span class="line">            LOGE(<span class="string">"binder_loop: unexpected reply?!\n"</span>)<span class="comment">;</span></span><br><span class="line">            <span class="keyword">break;</span></span><br><span class="line"><span class="keyword"> </span>       &#125;</span><br><span class="line">        <span class="meta">if</span> (res &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            LOGE(<span class="string">"binder_loop: io error %d %s\n"</span>, res, <span class="keyword">strerror(errno));</span></span><br><span class="line"><span class="keyword"> </span>           <span class="keyword">break;</span></span><br><span class="line"><span class="keyword"> </span>       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//ioctl是设备驱动程序中对设备的I/O通道进行管理的函数,函数是<span class="keyword">switch(cmd)条件判断,执行不同</span></span><br><span class="line"><span class="keyword">//的操作.cmd参数在用户程序端由一些宏根据设备类型、序列号、传送方向、数据尺寸等生成,这个整数</span></span><br><span class="line"><span class="keyword">//通过系统调用传递到内核中的驱动程序，再由驱动程序使用解码宏从这个整数中得到设备的类型、序列</span></span><br><span class="line"><span class="keyword">//号、传送方向、数据尺寸等信息，然后通过switch&#123;case&#125;结构进行相应的操作.</span></span><br><span class="line"><span class="keyword">int </span><span class="keyword">binder_write(struct </span><span class="keyword">binder_state </span>*<span class="keyword">bs, </span>void *<span class="meta">data</span>, unsigned len)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct </span><span class="keyword">binder_write_read </span><span class="keyword">bwr;</span></span><br><span class="line"><span class="keyword"> </span>   int res<span class="comment">;</span></span><br><span class="line">    <span class="keyword">bwr.write_size </span>= len<span class="comment">;</span></span><br><span class="line">    <span class="keyword">bwr.write_consumed </span>= <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    <span class="keyword">bwr.write_buffer </span>= (unsigned) <span class="meta">data</span><span class="comment">;</span></span><br><span class="line">    <span class="keyword">bwr.read_size </span>= <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    <span class="keyword">bwr.read_consumed </span>= <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    <span class="keyword">bwr.read_buffer </span>= <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    res = ioctl(<span class="keyword">bs-&gt;fd, </span><span class="keyword">BINDER_WRITE_READ, </span>&amp;<span class="keyword">bwr);</span></span><br><span class="line"><span class="keyword"> </span>   <span class="meta">if</span> (res &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        fprintf(stderr,<span class="string">"binder_write: ioctl failed (%s)\n"</span>,</span><br><span class="line">                <span class="keyword">strerror(errno));</span></span><br><span class="line"><span class="keyword"> </span>   &#125;</span><br><span class="line">    return res<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/19/android-frameworks-servermanager/" data-id="cjcix9dn2001c0onmf23gz4pn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/servermanager/">servermanager</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-C-operator" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/19/C-operator/" class="article-date">
  <time datetime="2016-01-19T02:50:06.000Z" itemprop="datePublished">2016-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/19/C-operator/">C++operator</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>参考文件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">platform<span class="regexp">/base/i</span>nclude<span class="regexp">/utils/</span>TextOutput.h</span><br></pre></td></tr></table></figure>
</li>
<li><p>关于Operator</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">我们只能使用,C++预定义的操作符,主要是依靠Operator的重载,扩大操作符的作用范围.</span><br><span class="line">virtual 为虚拟函数关键字,在有继承关系的类中,子类中可以覆盖父类中的方法.</span><br><span class="line">typedef 是为了提高代码的可读性,为变量,方法起别名.</span><br></pre></td></tr></table></figure>
</li>
<li><p>TextOutput.h中的</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">TextOutput</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">                        TextOutput();</span><br><span class="line">    <span class="keyword">virtual</span>             ~TextOutput();<span class="comment">//析构函数</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> status_t    <span class="title">print</span>(<span class="params"><span class="keyword">const</span> <span class="keyword">char</span>* txt, size_t len</span>) </span>= <span class="number">0</span>;<span class="comment">//打印函数</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span>        <span class="title">moveIndent</span>(<span class="params"><span class="keyword">int</span> delta</span>) </span>= <span class="number">0</span>;<span class="comment">//缩进函数</span></span><br><span class="line">    <span class="keyword">class</span>   <span class="title">Bundle</span> &#123;</span><br><span class="line">      <span class="keyword">public</span>:</span><br><span class="line">          <span class="function">inline <span class="title">Bundle</span>(<span class="params">TextOutput&amp; to</span>) : <span class="title">mTO</span>(<span class="params">to</span>) </span>&#123; to.pushBundle(); &#125;</span><br><span class="line">          inline ~Bundle() &#123; mTO.popBundle(); &#125;</span><br><span class="line">      <span class="keyword">private</span>:</span><br><span class="line">          TextOutput&amp;     mTO;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span>        <span class="title">pushBundle</span>(<span class="params"></span>) </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span>        <span class="title">popBundle</span>(<span class="params"></span>) </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">TextOutput&amp; endl(TextOutput&amp; to);<span class="comment">//换行</span></span><br><span class="line">TextOutput&amp; indent(TextOutput&amp; to);<span class="comment">//缩进</span></span><br><span class="line">TextOutput&amp; dedent(TextOutput&amp; to);<span class="comment">//反缩进</span></span><br><span class="line"><span class="comment">//打印相应数据类型</span></span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, <span class="keyword">const</span> <span class="keyword">char</span>* str);<span class="comment">//打印char</span></span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, <span class="keyword">char</span>);     <span class="comment">// writes raw character</span></span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, <span class="keyword">bool</span>);</span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, <span class="keyword">int</span>);<span class="comment">//打印</span></span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, <span class="keyword">long</span>);</span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, unsigned <span class="keyword">int</span>);</span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, unsigned <span class="keyword">long</span>);</span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, <span class="keyword">long</span> <span class="keyword">long</span>);</span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, unsigned <span class="keyword">long</span> <span class="keyword">long</span>);</span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, <span class="keyword">float</span>);</span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, <span class="keyword">double</span>);</span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, TextOutputManipFunc func);</span><br><span class="line">TextOutput&amp; <span class="keyword">operator</span>&lt;&lt;(TextOutput&amp; to, <span class="keyword">const</span> <span class="keyword">void</span>*);</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/19/C-operator/" data-id="cjcix9dlx00010onm0eby9esn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C++</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-frameworks-binder-ipc-thread-state" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/18/android-frameworks-binder-ipc-thread-state/" class="article-date">
  <time datetime="2016-01-18T07:48:49.000Z" itemprop="datePublished">2016-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/18/android-frameworks-binder-ipc-thread-state/">android-frameworks-binder-ipc_thread_state</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>参考的文件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android <span class="regexp">/ platform /</span> external <span class="regexp">/ pthreads /</span> master <span class="regexp">/ . /</span> pthread.h</span><br><span class="line">platfrom<span class="regexp">/base/</span>libs<span class="regexp">/binder/</span>IPCThreadState.cpp</span><br></pre></td></tr></table></figure>
</li>
<li><p>IPCThreadState的self()</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获得IPCState的实例</span></span><br><span class="line">IPCThreadState* IPCThreadState::self()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (gHaveTLS) &#123;<span class="comment">//是否拥有线程专有存储,默认为false</span></span><br><span class="line">restart:<span class="comment">//goto跳转标志</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">pthread_key_t</span> k = gTLS;</span><br><span class="line">      IPCThreadState* st = (IPCThreadState*)pthread_getspecific(k);</span><br><span class="line">      <span class="keyword">if</span> (st) <span class="keyword">return</span> st;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> IPCThreadState;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (gShutdown) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">  pthread_mutex_lock(&amp;gTLSMutex);</span><br><span class="line">  <span class="keyword">if</span> (!gHaveTLS) &#123;</span><br><span class="line">      <span class="keyword">if</span> (pthread_key_create(&amp;gTLS, threadDestructor) != <span class="number">0</span>) &#123;</span><br><span class="line">          pthread_mutex_unlock(&amp;gTLSMutex);</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      gHaveTLS = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  pthread_mutex_unlock(&amp;gTLSMutex);</span><br><span class="line">  <span class="keyword">goto</span> restart;</span><br><span class="line">&#125;</span><br><span class="line">在 IPCThreadState的实例中主要做了一下工作</span><br><span class="line"><span class="number">1</span>&gt;将该实例设到该线程专有的存储中</span><br><span class="line"><span class="number">2</span>&gt;设置与binder交互的缓存区</span><br></pre></td></tr></table></figure>
</li>
<li><p>IPCThreadState的transact()</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//int32_t cmd</span></span><br><span class="line"><span class="comment">//uint32_t binderFlags</span></span><br><span class="line"><span class="comment">//int32_t handle</span></span><br><span class="line"><span class="comment">//uint32_t code</span></span><br><span class="line"><span class="comment">//const Parcel&amp; data</span></span><br><span class="line"><span class="comment">//status_t* statusBuffer</span></span><br><span class="line"><span class="keyword">status_t</span> IPCThreadState::transact()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//将data中的属性封装到binder_transaction_data tr</span></span><br><span class="line">    <span class="comment">//并且将tr写入out缓冲区中</span></span><br><span class="line">    <span class="number">1</span>&gt;writeTransactionData()</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="number">2</span>&gt;waitForResponse()&#123;</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      cmd = mIn.readInt32();</span><br><span class="line">      err=talkWithDriver()</span><br><span class="line">      <span class="keyword">switch</span>(cmd)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">default</span>:</span><br><span class="line">        err = executeCommand(cmd);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//talkWithDriver(bool doReceive)</span></span><br><span class="line"><span class="comment">//跨设备通信,主要是通过ioctl(fmd,cmd,&amp;bwr)完成的,ioctl是Linux内核的方法</span></span><br><span class="line"><span class="comment">//暂不研究,在IPCThreadState的In缓存中,存储着请求信息</span></span><br><span class="line"><span class="keyword">tatus_t</span> IPCThreadState::talkWithDriver(<span class="keyword">bool</span> doReceive)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="number">1</span>&gt;断言是否成功打开Binder设备</span><br><span class="line">    <span class="number">2</span>&gt; binder_write_read bwr</span><br><span class="line">    <span class="number">3</span>&gt;判断是否in缓存有数据需要读</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">bool</span> needRead = mIn.dataPosition() &gt;= mIn.dataSize();</span><br><span class="line">    <span class="number">4</span>&gt;获得out缓存可用的空间</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">size_t</span> outAvail = (!doReceive || needRead) ? mOut.dataSize() : <span class="number">0</span>;</span><br><span class="line">    <span class="number">5</span>&gt;将out缓存可用的空间以及数据占用情况赋值给binder的读写数据结构 bwr</span><br><span class="line">    bwr.write_size = outAvail;</span><br><span class="line">    bwr.write_buffer = (<span class="keyword">long</span> <span class="keyword">unsigned</span> <span class="keyword">int</span>)mOut.data();</span><br><span class="line">    <span class="number">6</span>&gt;<span class="comment">//有读取请求,并且执行的是doRecive,就将请求的数据所占的空间赋值给binder读写数据结构bwr</span></span><br><span class="line">    <span class="keyword">if</span> (doReceive &amp;&amp; needRead) &#123;</span><br><span class="line">        bwr.read_size = mIn.dataCapacity();</span><br><span class="line">        bwr.read_buffer = (<span class="keyword">long</span> <span class="keyword">unsigned</span> <span class="keyword">int</span>)mIn.data();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        bwr.read_size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">7</span>&gt;<span class="comment">//打印相关日志</span></span><br><span class="line">    IF_LOG_COMMANDS() &#123;</span><br><span class="line">        TextOutput::Bundle _b(alog);</span><br><span class="line">        <span class="keyword">if</span> (outAvail != <span class="number">0</span>) &#123;</span><br><span class="line">            alog &lt;&lt; <span class="string">"Sending commands to driver: "</span> &lt;&lt; indent;</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">void</span>* cmds = (<span class="keyword">const</span> <span class="keyword">void</span>*)bwr.write_buffer;</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">void</span>* end = ((<span class="keyword">const</span> <span class="keyword">uint8_t</span>*)cmds)+bwr.write_size;</span><br><span class="line">            alog &lt;&lt; HexDump(cmds, bwr.write_size) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">while</span> (cmds &lt; end) cmds = printCommand(alog, cmds);</span><br><span class="line">            alog &lt;&lt; dedent;</span><br><span class="line">        &#125;</span><br><span class="line">        alog &lt;&lt; <span class="string">"Size of receive buffer: "</span> &lt;&lt; bwr.read_size</span><br><span class="line">            &lt;&lt; <span class="string">", needRead: "</span> &lt;&lt; needRead &lt;&lt; <span class="string">", doReceive: "</span> &lt;&lt; doReceive &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//没有可以读写的</span></span><br><span class="line">    <span class="keyword">if</span> ((bwr.write_size == <span class="number">0</span>) &amp;&amp; (bwr.read_size == <span class="number">0</span>)) <span class="keyword">return</span> NO_ERROR;</span><br><span class="line">    <span class="comment">//初始化关于读写的</span></span><br><span class="line">    bwr.write_consumed = <span class="number">0</span>;</span><br><span class="line">    bwr.read_consumed = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">status_t</span> err;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">if</span> defined(HAVE_ANDROID_OS)</span></span><br><span class="line">                <span class="comment">//这是关键</span></span><br><span class="line">                <span class="keyword">if</span> (ioctl(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr) &gt;= <span class="number">0</span>)</span><br><span class="line">                    err = NO_ERROR;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    err = -errno;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">                err = INVALID_OPERATION;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (err &gt;= NO_ERROR) &#123;</span><br><span class="line">        <span class="keyword">if</span> (bwr.write_consumed &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (bwr.write_consumed &lt; (<span class="keyword">ssize_t</span>)mOut.dataSize())</span><br><span class="line">                mOut.remove(<span class="number">0</span>, bwr.write_consumed);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                mOut.setDataSize(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bwr.read_consumed &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            mIn.setDataSize(bwr.read_consumed);</span><br><span class="line">            mIn.setDataPosition(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> NO_ERROR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/18/android-frameworks-binder-ipc-thread-state/" data-id="cjcix9dmz00170onm7szhw5ku" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/binder/">binder</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-framework-binder-common-class" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/15/android-framework-binder-common-class/" class="article-date">
  <time datetime="2016-01-15T09:09:28.000Z" itemprop="datePublished">2016-01-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/15/android-framework-binder-common-class/">android_framework_binder_common_class</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>参考文件</li>
<li>ProcessState的介绍<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&gt; 继承于RefBase</span><br><span class="line"><span class="number">2</span>&gt;关于getContextObject()</span><br><span class="line">sp&lt;IBinder&gt; ProcessState::getContextObject(<span class="keyword">const</span> sp&lt;IBinder&gt;&amp; caller)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//在创建ProcessState实例过程中如果成功打开binder设备supportsProcesses()为true</span></span><br><span class="line">    <span class="comment">//取决与open_driver()返回的参数</span></span><br><span class="line">    <span class="keyword">if</span> (supportsProcesses()) &#123;</span><br><span class="line">        <span class="keyword">return</span> getStrongProxyForHandle(<span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getContextObject(String16(<span class="string">"default"</span>), caller);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//让我们来看一下</span></span><br><span class="line">sp&lt;IBinder&gt; ProcessState::getStrongProxyForHandle(<span class="keyword">int32_t</span> handle)</span><br><span class="line">&#123;</span><br><span class="line">    sp&lt;IBinder&gt; result;</span><br><span class="line">    AutoMutex _l(mLock);<span class="comment">//自动同步机制</span></span><br><span class="line">    <span class="comment">//handle_entry</span></span><br><span class="line">    handle_entry* e = lookupHandleLocked(handle);</span><br><span class="line">    <span class="keyword">if</span> (e != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="comment">// We need to create a new BpBinder if there isn't currently one, OR we</span></span><br><span class="line">        <span class="comment">// are unable to acquire a weak reference on this current one.  See comment</span></span><br><span class="line">        <span class="comment">// in getWeakProxyForHandle() for more info about this.</span></span><br><span class="line">        IBinder* b = e-&gt;binder;</span><br><span class="line">        <span class="keyword">if</span> (b == <span class="literal">NULL</span> || !e-&gt;refs-&gt;attemptIncWeak(<span class="keyword">this</span>)) &#123;</span><br><span class="line">            b = <span class="keyword">new</span> BpBinder(handle);</span><br><span class="line">            e-&gt;binder = b;</span><br><span class="line">            <span class="keyword">if</span> (b) e-&gt;refs = b-&gt;getWeakRefs();</span><br><span class="line">            result = b;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// This little bit of nastyness is to allow us to add a primary</span></span><br><span class="line">            <span class="comment">// reference to the remote proxy when this team doesn't have one</span></span><br><span class="line">            <span class="comment">// but another team is sending the handle to us.</span></span><br><span class="line">            result.force_set(b);</span><br><span class="line">            e-&gt;refs-&gt;decWeak(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">ProcessState::handle_entry* ProcessState::lookupHandleLocked(<span class="keyword">int32_t</span> handle)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//mHandleToObject是Vector,里面存放的是handle_entry</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">size_t</span> N=mHandleToObject.size();</span><br><span class="line">    <span class="keyword">if</span> (N &lt;= (<span class="keyword">size_t</span>)handle) &#123;</span><br><span class="line">        handle_entry e;</span><br><span class="line">        e.binder = <span class="literal">NULL</span>;</span><br><span class="line">        e.refs = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">status_t</span> err = mHandleToObject.insertAt(e, N, handle+<span class="number">1</span>-N);</span><br><span class="line">        <span class="keyword">if</span> (err &lt; NO_ERROR) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &amp;mHandleToObject.editItemAt(handle);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">handle_entry</span> &#123;</span></span><br><span class="line">     IBinder* binder;</span><br><span class="line">     RefBase::weakref_type* refs;</span><br><span class="line"> &#125;;</span><br><span class="line"> 总结: 在ProcessState的getContextObject()根据打开Binder设备的情况,</span><br><span class="line"> 若成功测调用getStrongProxyForHandle(),并且返回handle所对应的handle_entry,</span><br><span class="line"> 若handle_entry不为空,并且该handle_entry的binder为空或者其refs尝试</span><br><span class="line"> 增加弱引用失败,就重新新建BpBinder,并且把BpBinder*的实例返回.</span><br><span class="line"> getStrongProxyForHandle()逻辑如下:</span><br><span class="line"> 从handle_entry的集合中先查找对应的handle_entry,若没有则创建新的handle_entry,</span><br><span class="line"> 并且插入到hanle_entry集合的队尾,且返回handle所对应的handle_entry.</span><br><span class="line"> binder为<span class="keyword">new</span> BpIbinder();</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/15/android-framework-binder-common-class/" data-id="cjcix9dmp000u0onmndb778yx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/binder/">binder</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-frameworks-binder-communication" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/15/android-frameworks-binder-communication/" class="article-date">
  <time datetime="2016-01-15T07:08:22.000Z" itemprop="datePublished">2016-01-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/15/android-frameworks-binder-communication/">android_frameworks_binder_communication</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>参考文件</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">av<span class="meta-keyword">/media/</span>mediaserver/main_mediaserver.cpp</span><br><span class="line">platform<span class="meta-keyword">/base/</span>media<span class="meta-keyword">/libmediaplayerservice/</span>MediaPlayerService.cpp</span><br><span class="line">platform<span class="meta-keyword">/base/</span>include<span class="meta-keyword">/binder/</span>IInterface.h</span><br></pre></td></tr></table></figure>
</li>
<li><p>main_mediaserver中的main函数逻辑如下</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc __unused, <span class="built_in">char</span>** argv)&#123;</span><br><span class="line">  <span class="comment">//获得ProcessState实例单例模式,创建ProcessState实例也是打开binder虚拟设备的过程</span></span><br><span class="line">  <span class="comment">//这其中会挂载文件,映射内存</span></span><br><span class="line">  sp&lt;ProcessState&gt; <span class="keyword">proc</span>(ProcessState::<span class="keyword">self</span>());</span><br><span class="line">  MediaLogService::instantiate();</span><br><span class="line">  ProcessState::<span class="keyword">self</span>()-&gt;startThreadPool();</span><br><span class="line">  <span class="comment">//获得sp&lt;IServiceManager&gt;的实例</span></span><br><span class="line">  sp&lt;IServiceManager&gt; sm = defaultServiceManager();</span><br><span class="line">  sp&lt;IBinder&gt; binder = sm-&gt;getService(String16(<span class="string">"media.log"</span>));</span><br><span class="line">  <span class="comment">//实例化各种相关的服务</span></span><br><span class="line">  AudioFlinger::instantiate();</span><br><span class="line">  MediaPlayerService::instantiate();</span><br><span class="line">  ResourceManagerService::instantiate();</span><br><span class="line">  CameraService::instantiate();</span><br><span class="line">  AudioPolicyService::instantiate();</span><br><span class="line">  SoundTriggerHwService::instantiate();</span><br><span class="line">  RadioService::instantiate();</span><br><span class="line">  registerExtensions();</span><br><span class="line">  <span class="comment">//开启线程池</span></span><br><span class="line">  ProcessState::<span class="keyword">self</span>()-&gt;startThreadPool();</span><br><span class="line">  IPCThreadState::<span class="keyword">self</span>()-&gt;joinThreadPool();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>defaultServiceManager()功能如下</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//defaultServiceManager()代码如下</span></span><br><span class="line">sp&lt;IServiceManager&gt; defaultServiceManager()</span><br><span class="line">&#123;</span><br><span class="line">    gDefaultServiceManager = interface_cast&lt;IServiceManager&gt;(</span><br><span class="line">                ProcessState::self()-&gt;getContextObject(NULL));</span><br><span class="line">    return gDefaultServiceManager;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//由于IServiceMananer继承与IInterface ,因此interface_cast()为IInterface中的template</span></span><br><span class="line"><span class="comment">//函数,实质是调用template(IServiceMananer)的asInterface方法,这里是宏方法</span></span><br><span class="line"><span class="comment">//#define DECLARE_META_INTERFACE(INTERFACE)      </span></span><br><span class="line">template&lt;typename INTERFACE&gt;</span><br><span class="line"><span class="keyword">inline</span> sp&lt;INTERFACE&gt; interface_cast(const sp&lt;IBinder&gt;&amp; obj)</span><br><span class="line">&#123;</span><br><span class="line">    return INTERFACE::asInterface(obj);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//宏方法asInterface()事实上defaultServiceManager是BpServiceManager的实例</span></span><br><span class="line">#define IMPLEMENT_META_INTERFACE(INTERFACE, NAME)                       \                                                                             android::sp&lt;I##INTERFACE&gt; I##INTERFACE::asInterface(                    \</span><br><span class="line">            const android::sp&lt;android::IBinder&gt;&amp; obj)                   \</span><br><span class="line">    &#123;                                                                   \</span><br><span class="line"></span><br><span class="line">        return intrintr = new Bp##INTERFACE(obj); ;                     \</span><br><span class="line">    &#125;                                                                   \</span><br><span class="line">    I##INTERFACE::I##INTERFACE() &#123; &#125;                                    \</span><br><span class="line">    I##INTERFACE::~I##INTERFACE() &#123; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在MediaPlayerService中</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">void</span> MediaPlayerService::instantiate() &#123;</span><br><span class="line">    defaultServiceManager<span class="function"><span class="params">()</span>-&gt;</span>addService(</span><br><span class="line">            String16(<span class="string">"media.player"</span>), <span class="keyword">new</span> MediaPlayerService());</span><br><span class="line">&#125;</span><br><span class="line">总结:</span><br><span class="line"><span class="number">1</span>&gt;各种ServiceManager.addService()实质上是defaultServiceManager.addService()</span><br><span class="line">而在有是调用的binder-<span class="function">-&gt;</span>transact<span class="function"><span class="params">()</span>,进而是<span class="title">IPCThreadState</span>::<span class="title">self</span><span class="params">()</span>--&gt;</span>transact()</span><br><span class="line"><span class="number">2</span>&gt;参数流如下:</span><br><span class="line">addService(<span class="keyword">const</span> String16&amp; name, <span class="keyword">const</span> sp&lt;IBinder&gt;&amp; service)主要工作如下:</span><br><span class="line">  <span class="number">1.</span>声明两个Parcel实例data reply</span><br><span class="line">  <span class="number">2.</span>将name和service写到data中</span><br><span class="line">  <span class="number">3.</span>调用binder-<span class="function">-&gt;</span>transact(ADD_SERVICE_TRANSACTION,data,&amp;reply)</span><br><span class="line">binder::transact()</span><br><span class="line">   IPCThreadState::self<span class="function"><span class="params">()</span>-&gt;</span>transact(mHandle, code, data, reply, flags);</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/15/android-frameworks-binder-communication/" data-id="cjcix9dmx00160onm0zdsq1l0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/binder/">binder</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-frameworks-binder" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/15/android-frameworks-binder/" class="article-date">
  <time datetime="2016-01-15T01:54:43.000Z" itemprop="datePublished">2016-01-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/15/android-frameworks-binder/">android_frameworks_binder</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>RefBase 指针管理公共类,提供引用计数的方法,但由StrongPointer和WeakPointer来管理.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RefBase</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">void</span>  <span class="title">incStrong</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* id)</span> <span class="keyword">const</span></span>;增加强引用</span><br><span class="line"><span class="function"><span class="keyword">void</span>  <span class="title">decStrong</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* id)</span> <span class="keyword">const</span></span>;减少强引用</span><br><span class="line"><span class="function"><span class="keyword">void</span>  <span class="title">forceIncStrong</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* id)</span> <span class="keyword">const</span></span>;强制增加强引用</span><br><span class="line"><span class="keyword">int32_t</span>   getStrongCount() <span class="keyword">const</span>;获得当前强引用的数量</span><br><span class="line"><span class="comment">//创建弱引用类型</span></span><br><span class="line"><span class="function">weakref_type*   <span class="title">createWeak</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* id)</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function">weakref_type*   <span class="title">getWeakRefs</span><span class="params">()</span> <span class="keyword">const</span></span>;<span class="comment">//获得弱引用类型</span></span><br><span class="line"><span class="comment">//追踪</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span>  <span class="keyword">void</span>    <span class="title">trackMe</span><span class="params">(<span class="keyword">bool</span> enable, <span class="keyword">bool</span> retain)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    getWeakRefs()-&gt;trackMe(enable, retain);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//若弱类型的处理</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">weakref_type</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span>  <span class="title">incWeak</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* id)</span></span>;增加弱引用</span><br><span class="line">  <span class="function"><span class="keyword">void</span>  <span class="title">decWeak</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* id)</span></span>;减少弱引用</span><br><span class="line">  <span class="function"><span class="keyword">bool</span>  <span class="title">attemptIncStrong</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* id)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span>  <span class="title">attemptIncWeak</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* id)</span></span>;</span><br><span class="line">  <span class="keyword">int32_t</span>   getWeakCount() <span class="keyword">const</span>;获得弱引用的数量</span><br><span class="line">  <span class="function"><span class="keyword">void</span>  <span class="title">trackMe</span><span class="params">(<span class="keyword">bool</span> enable, <span class="keyword">bool</span> retain)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>IInterface的功能</p>
<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">1&gt; </span> 继承与RefBase</span><br><span class="line"><span class="meta">2&gt; </span> 定义了许多template函数常见的有</span><br><span class="line">interface_cast(sp&lt;IBinder&gt;)</span><br><span class="line"><span class="meta">3&gt; </span> 定义了template的类</span><br><span class="line">BpInterface</span><br><span class="line">BnInterface</span><br><span class="line"><span class="meta">4&gt; </span> 定义了宏方法</span><br><span class="line">#define DECLARE_META_INTERFACE(INTERFACE)</span><br><span class="line">#define IMPLEMENT_META_INTERFACE(INTERFACE, NAME)  </span><br><span class="line"><span class="number">5</span>&gt;常见方法</span><br><span class="line">sp&lt;IBinder&gt;asBinder</span><br></pre></td></tr></table></figure>
</li>
<li><p>IServiceMananer的功能</p>
<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&gt;继承于Interface</span><br><span class="line"><span class="number">2</span>&gt;addService()</span><br><span class="line">  listService()</span><br><span class="line">  checkService()</span><br><span class="line">  getService()</span><br><span class="line"><span class="meta">3&gt; </span>重要的方法</span><br><span class="line">  sp&lt;IServiceMananger&gt;defaultServiceManager()</span><br><span class="line">  class BnServiceManager : public BnInterface&lt;IServiceManager&gt;</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    virtual status_t   onTransact()</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>BpServiceManager的功能</p>
<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">1&gt; </span> 继承与BpInterface&lt;IServiceMananger&gt;</span><br><span class="line">注意:范型表示BpInterface继承于IServiceMananger\</span><br><span class="line">见模板函数BpInterface 定义</span><br></pre></td></tr></table></figure>
</li>
<li><p>BpInterface的定义</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">template</span>&lt;<span class="selector-tag">typename</span> <span class="selector-tag">INTERFACE</span>&gt;</span><br><span class="line"><span class="selector-tag">class</span> <span class="selector-tag">BpInterface</span> : <span class="selector-tag">public</span> <span class="selector-tag">INTERFACE</span>, <span class="selector-tag">public</span> <span class="selector-tag">BpRefBase</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="attribute">public</span>:</span><br><span class="line">    <span class="built_in">BpInterface</span>(const sp&lt;IBinder&gt;&amp; remote);</span><br><span class="line"><span class="attribute">protected</span>:</span><br><span class="line">    virtual IBinder*   <span class="built_in">onAsBinder</span>();</span><br><span class="line">&#125;;  +</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/15/android-frameworks-binder/" data-id="cjcix9dn1001a0onm5mr7m2dw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/binder/">binder</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-framework-launch-activity-viewroot" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/13/android-framework-launch-activity-viewroot/" class="article-date">
  <time datetime="2016-01-13T12:27:08.000Z" itemprop="datePublished">2016-01-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/13/android-framework-launch-activity-viewroot/">ViewRootIml</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>参考文件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">framework<span class="regexp">/base/</span>core<span class="regexp">/java/</span>android<span class="regexp">/view/</span>ViewRoot.java</span><br></pre></td></tr></table></figure>
</li>
<li><p>ViewRoot下的setView()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/13/android-framework-launch-activity-viewroot/" data-id="cjcix9dmt00100onmnup2s5og" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/view-root-iml/">view_root_iml</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-framework-launch-activity-setContentView" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/12/android-framework-launch-activity-setContentView/" class="article-date">
  <time datetime="2016-01-12T13:29:41.000Z" itemprop="datePublished">2016-01-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/12/android-framework-launch-activity-setContentView/">android_framework_setContentView</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>参考文件</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">framework/base/core/java/android/app/Activity.java</span><br><span class="line">base/phone/com<span class="selector-class">.android</span><span class="selector-class">.internal</span><span class="selector-class">.policy</span><span class="selector-class">.impl</span><span class="selector-class">.PhoneWindow</span><span class="selector-class">.java</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在Activity中setContentView()</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">getWindow</span>()<span class="selector-class">.setContentView</span>(layoutResID);<span class="comment">//PhoneWindow</span></span><br><span class="line"><span class="selector-tag">initWindowDecorActionBar</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>在PhoneWindow中setContentView()</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContentView</span>(<span class="params">View view, ViewGroup.LayoutParams <span class="keyword">params</span></span>) </span>&#123;</span><br><span class="line">       <span class="number">1</span>&gt;如果mContentParent为空调用installDecor,不为空移除mContentParent中的子View</span><br><span class="line">       <span class="number">2</span>&gt;将view设置到mContentParent中</span><br><span class="line">       <span class="number">3</span>&gt;mContentParent 事实上是ViewGroup 事实上是ViewGroup</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">installDecor</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="number">1</span>&gt;判断DecorView 是否为空若为空调用 generateDecor()</span><br><span class="line">          <span class="number">2</span>&gt;判断mContentParent是否为空,若为空,调用generateLayout(mDecor)</span><br><span class="line">          并且设置标题栏的可见否</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> ViewGroup <span class="title">generateLayout</span>(<span class="params">DecorView decor</span>) </span>&#123;</span><br><span class="line">   ViewGroup contentParent = (ViewGroup)findViewById(ID_ANDROID_CONTENT);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">findViewById</span>(<span class="params"><span class="keyword">int</span> id</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getDecorView().findViewById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DecorView</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DecorView 本质上是FrameLayout,是<span class="built_in">window</span>中top_level <span class="built_in">View</span>;</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/12/android-framework-launch-activity-setContentView/" data-id="cjcix9dms000y0onm4taspbw4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/set-content-view/">set_content_view</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-framework-launch-activity" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/12/android-framework-launch-activity/" class="article-date">
  <time datetime="2016-01-12T07:50:54.000Z" itemprop="datePublished">2016-01-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/12/android-framework-launch-activity/">Activity 启动</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>参考文件</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">framework<span class="meta-keyword">/base/</span>core<span class="meta-keyword">/java/</span>android<span class="meta-keyword">/app/</span>ActivityThread.java</span><br><span class="line">framework<span class="meta-keyword">/base/</span>core<span class="meta-keyword">/java/</span>android<span class="meta-keyword">/content/</span>pm/ActivityInfo.java</span><br><span class="line">framework<span class="meta-keyword">/base/</span>services<span class="meta-keyword">/java/</span>com<span class="meta-keyword">/android/</span>server<span class="meta-keyword">/am/</span>ActivityRecord.java</span><br></pre></td></tr></table></figure>
</li>
<li><p>zygote该进程会fork一个子进程即app进程,该进程的入口处是Activity<br>Thread的main函数,主要进行如下工作:</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) &#123;</span><br><span class="line">  <span class="number">1.</span>准备工作 开启事件追踪--事件Tag为ActivityThreadMain,</span><br><span class="line">  初始化当前用户,创建Looper对象,创建MainHandler                 </span><br><span class="line">  <span class="number">2.</span>创建ActivityThread的实例thread,并调用<span class="built_in">attach</span>(<span class="keyword">boolean</span>)</span><br><span class="line">  <span class="number">3.</span>获得Looper 并启动它looper.<span class="built_in">loop</span>();</span><br><span class="line">  <span class="number">4.</span>thread.<span class="built_in">detach</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ActivityThread中的handleLauchActivity(<br>ActivityClientRecord r, Intent customIntent)中<br>的主要逻辑</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ActivityClientRecord 主要记录一下信息:</span><br><span class="line"><span class="meta">1&gt;</span><span class="bash">Intent</span></span><br><span class="line"><span class="meta">2&gt;</span><span class="bash">ActivityInfo</span></span><br><span class="line"><span class="meta">3&gt;</span><span class="bash">LoadApk 主要包括ApplicationInfo ActivityThread packageName(String)</span></span><br><span class="line">  appDir,libDir,dataDir,Resource,ClassLoader,Application,</span><br><span class="line">  CompatibilityInfo(关于屏幕匹配的信息density,屏幕applicationscaled).</span><br><span class="line"><span class="meta">4&gt;</span><span class="bash">Window</span></span><br><span class="line"><span class="meta">5&gt;</span><span class="bash">Activity</span></span><br><span class="line"><span class="meta">6&gt;</span><span class="bash">boolean paused stoped</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private void handleLaunchActivity(ActivityClientRecord r,</span><br><span class="line"> Intent customIntent) &#123;</span><br><span class="line">       Activity a = performLaunchActivity(r, customIntent);</span><br><span class="line">       handleResumeActivity(r.token,false,r.isForward,</span><br><span class="line">         !r.activity.mFinished &amp;&amp; !r.startsNotResumed);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>performLaunchActivity的逻辑如下:</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> void Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123;</span><br><span class="line">  <span class="number">1</span>&gt;获得ActiviytInfo<span class="comment">-- r.activityInfo</span></span><br><span class="line">    activityInfo 主要包含了以下信息:targgetActivity softInput theme ,permission,</span><br><span class="line">    screenOrintion,launchMode.</span><br><span class="line">  <span class="number">2</span>&gt;获得packageInfo <span class="comment">--getPackageInfo(applicationInfo,compatInfo,flag)</span></span><br><span class="line">  <span class="number">3</span>&gt;获得组件的名字<span class="comment">--r.intent.getComponent(),如果activityInfo.tatargetActivity 不为空,创建ComponentName的对象</span></span><br><span class="line">  component = <span class="keyword">new</span> ComponentName(r.activityInfo.packageName,</span><br><span class="line">                r.activityInfo.targetActivity);</span><br><span class="line">  <span class="number">4</span>&gt;获得Activity的实例</span><br><span class="line">    <span class="number">1</span>&gt;获得ClassLoader<span class="comment">---r.packageInfo.getClassLoader();</span></span><br><span class="line">    <span class="number">2</span>&gt;生成Activity实例<span class="comment">---activity = mInstrumentation.newActivity(</span></span><br><span class="line">            cl, component.getClassName(), r.intent);</span><br><span class="line">  <span class="number">5</span>&gt;activity的属性设置</span><br><span class="line">      <span class="number">1</span>&gt;生成Application 实例<span class="comment">---r.packageInfo.makeApplication(false, mInstrumentation)</span></span><br><span class="line">      <span class="number">2</span>&gt;生成Context<span class="comment">---appContext = new ContextIml()                                     ;</span></span><br><span class="line">      <span class="number">3</span>&gt;生成Configuration</span><br><span class="line">      <span class="number">4</span>&gt;将相关属性设置到activity,生成Window,设置windowmanager<span class="comment">-----activity.attach();</span></span><br><span class="line">  <span class="number">6</span>&gt;activity 生命周期</span><br><span class="line">      <span class="number">1</span>&gt;  <span class="keyword">if</span> (r.isPersistable()) &#123;</span><br><span class="line">            mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mInstrumentation.callActivityOnCreate(activity, r.state);</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="number">2</span>&gt; 根据条件启动start restore</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>handleResumeActivity()的具体逻辑</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span>  handleResumeActivity(IBinder token,</span><br><span class="line">            <span class="keyword">boolean</span> clearHide, <span class="keyword">boolean</span> isForward, <span class="keyword">boolean</span> reallyResume) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="number">1</span>&gt;调用GC</span><br><span class="line">        <span class="number">2</span>&gt;执行performResumeActivity(token, clearHide)并 且获得ActivityClientRecord r</span><br><span class="line">        <span class="number">3</span>&gt;设置activity在生命周期变化后一些属性,activity位于栈的顶端时自动设置软件盘</span><br><span class="line">        的显示.</span><br><span class="line">        <span class="number">4</span>&gt;获得Activity的window,将获得DecorView,并添加到WindowManager中</span><br><span class="line">              *window是绘制顶层窗口和标题栏,以及背景</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Instrument的作用—-控制创建Activity的实例和Activity的生命周期</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Activity <span class="keyword">new</span><span class="type">Activity</span>(ClassLoader cl, <span class="keyword">String</span> className,</span><br><span class="line">        Intent intent)throws InstantiationException,IllegalAccessException,</span><br><span class="line">        ClassNotFoundException &#123;</span><br><span class="line">          <span class="keyword">return</span> (Activity)cl.loadClass(className).<span class="keyword">new</span><span class="type">Instance</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/12/android-framework-launch-activity/" data-id="cjcix9dmu00120onm7yqp876n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/launch-activity/">launch_activity</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-framework-init-process" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/12/android-framework-init-process/" class="article-date">
  <time datetime="2016-01-12T05:18:05.000Z" itemprop="datePublished">2016-01-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/12/android-framework-init-process/">android_framework_init_process</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>所涉及到的文件路径<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">system/core/rootdir/<span class="keyword">init</span>.rc</span><br><span class="line">system/core/<span class="keyword">init</span>/<span class="keyword">init</span>.cpp</span><br></pre></td></tr></table></figure></p>
<p>1.作为android系统的第一个进程编号为1</p>
<p>2.该进程文件位于system/core/init/init.cpp其main函数主要作了如下工作<br><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">1&gt; </span>创建文件夹 挂载设备</span><br><span class="line"><span class="number">2</span>&gt;解析init.rc 和init.xiaomi.rc配置文件获得一系列的Action.</span><br><span class="line">这些Action处于不同的阶段(Session).</span><br><span class="line"><span class="number">3</span>&gt;执行各个阶段的Action</span><br><span class="line"><span class="number">4</span>&gt;首先执行early_init 阶段的Action,创建Uevnet与Linux内核交互</span><br><span class="line">的Socket,初始化相关的属性资源,初始化keychord的设备(与调试有关),</span><br><span class="line">加载开机动画文件.</span><br><span class="line"><span class="number">5</span>&gt;其次执行init阶段的动画,启动属性服务调用socketpair函数创建两个</span><br><span class="line">已经连接好的socket</span><br><span class="line"><span class="number">6</span>&gt;继续执行early_boot阶段的Action</span><br><span class="line"><span class="number">7</span>&gt;再执行booot阶段的Action</span><br><span class="line"><span class="number">8</span>&gt;监听来自四个方面的事情,来自内核的Uevent事件,来自属性服务器的事件</span><br><span class="line">,由socketpair创建的来自另一个socket的事件,以及keychord初始化成功</span><br><span class="line">情况下,来自该设备的事件.</span><br><span class="line"><span class="meta">9&gt; </span>开启无限循环,重启死去的子进程</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/12/android-framework-init-process/" data-id="cjcix9dmr000w0onmuh09h8vm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android-init-process/">android init_process</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/5/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/7/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/bat/">.bat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-Object/">C Object</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-jvm-GC/">Java jvm GC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MVP/">MVP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Parcelable/">Parcelable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TLS/">TLS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aidl/">aidl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-init-process/">android init_process</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-proguard/">android proguard</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-event-dispatch/">android_event_dispatch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/binder/">binder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/content-provider/">content_provider</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/database-mysql/">database mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/float/">float</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go-beego/">go beego</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle/">gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle-Project/">gradle Project</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle-Task/">gradle Task</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle-proguard/">gradle proguard</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/handler/">handler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http-status/">http-status</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-concurrent/">java concurrent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-jvm/">java jvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-jvm-class-struct/">java jvm class_struct</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-thread/">java thread</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/launch-activity/">launch_activity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux-cmd/">linux-cmd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/long-running-operation/">long_running_operation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/motion-event-multify-touch/">motion_event multify_touch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql-table/">mysql table</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql-backup/">mysql-backup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx-cache/">nginx cache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx-https/">nginx https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx-loader-balance/">nginx loader_balance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx-reverse-proxy/">nginx reverse-proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-install/">python-install</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reflect/">reflect</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/">security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/server-nginx/">server nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/servermanager/">servermanager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/set-content-view/">set_content_view</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh-scp/">ssh scp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svg/">svg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svn/">svn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/usb-booter/">usb-booter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/view-root-iml/">view_root_iml</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/bat/" style="font-size: 10px;">.bat</a> <a href="/tags/C-Object/" style="font-size: 10px;">C Object</a> <a href="/tags/C/" style="font-size: 10px;">C++</a> <a href="/tags/Java-jvm-GC/" style="font-size: 10px;">Java jvm GC</a> <a href="/tags/JavaScript/" style="font-size: 13.33px;">JavaScript</a> <a href="/tags/MVP/" style="font-size: 10px;">MVP</a> <a href="/tags/Parcelable/" style="font-size: 10px;">Parcelable</a> <a href="/tags/TLS/" style="font-size: 10px;">TLS</a> <a href="/tags/aidl/" style="font-size: 10px;">aidl</a> <a href="/tags/android-init-process/" style="font-size: 10px;">android init_process</a> <a href="/tags/android-proguard/" style="font-size: 10px;">android proguard</a> <a href="/tags/android-event-dispatch/" style="font-size: 10px;">android_event_dispatch</a> <a href="/tags/binder/" style="font-size: 20px;">binder</a> <a href="/tags/c/" style="font-size: 10px;">c++</a> <a href="/tags/content-provider/" style="font-size: 10px;">content_provider</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/database-mysql/" style="font-size: 10px;">database mysql</a> <a href="/tags/float/" style="font-size: 10px;">float</a> <a href="/tags/go-beego/" style="font-size: 10px;">go beego</a> <a href="/tags/gradle/" style="font-size: 13.33px;">gradle</a> <a href="/tags/gradle-Project/" style="font-size: 10px;">gradle Project</a> <a href="/tags/gradle-Task/" style="font-size: 10px;">gradle Task</a> <a href="/tags/gradle-proguard/" style="font-size: 10px;">gradle proguard</a> <a href="/tags/handler/" style="font-size: 10px;">handler</a> <a href="/tags/http-status/" style="font-size: 10px;">http-status</a> <a href="/tags/java-concurrent/" style="font-size: 10px;">java concurrent</a> <a href="/tags/java-jvm/" style="font-size: 10px;">java jvm</a> <a href="/tags/java-jvm-class-struct/" style="font-size: 10px;">java jvm class_struct</a> <a href="/tags/java-thread/" style="font-size: 10px;">java thread</a> <a href="/tags/launch-activity/" style="font-size: 13.33px;">launch_activity</a> <a href="/tags/linux-cmd/" style="font-size: 10px;">linux-cmd</a> <a href="/tags/long-running-operation/" style="font-size: 10px;">long_running_operation</a> <a href="/tags/motion-event-multify-touch/" style="font-size: 10px;">motion_event multify_touch</a> <a href="/tags/mysql/" style="font-size: 16.67px;">mysql</a> <a href="/tags/mysql-table/" style="font-size: 10px;">mysql table</a> <a href="/tags/mysql-backup/" style="font-size: 10px;">mysql-backup</a> <a href="/tags/nginx-cache/" style="font-size: 10px;">nginx cache</a> <a href="/tags/nginx-https/" style="font-size: 10px;">nginx https</a> <a href="/tags/nginx-loader-balance/" style="font-size: 10px;">nginx loader_balance</a> <a href="/tags/nginx-reverse-proxy/" style="font-size: 10px;">nginx reverse-proxy</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/python-install/" style="font-size: 10px;">python-install</a> <a href="/tags/reflect/" style="font-size: 10px;">reflect</a> <a href="/tags/security/" style="font-size: 10px;">security</a> <a href="/tags/server-nginx/" style="font-size: 16.67px;">server nginx</a> <a href="/tags/servermanager/" style="font-size: 10px;">servermanager</a> <a href="/tags/set-content-view/" style="font-size: 10px;">set_content_view</a> <a href="/tags/ssh-scp/" style="font-size: 10px;">ssh scp</a> <a href="/tags/svg/" style="font-size: 13.33px;">svg</a> <a href="/tags/svn/" style="font-size: 10px;">svn</a> <a href="/tags/test/" style="font-size: 13.33px;">test</a> <a href="/tags/usb-booter/" style="font-size: 10px;">usb-booter</a> <a href="/tags/view-root-iml/" style="font-size: 10px;">view_root_iml</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/01/17/android-event-dispatch/">android-event-dispatch</a>
          </li>
        
          <li>
            <a href="/2018/01/15/java-study-jvm-class/">java-study-class</a>
          </li>
        
          <li>
            <a href="/2017/12/29/svg-study-1/">svg_study</a>
          </li>
        
          <li>
            <a href="/2017/12/13/svg-study/">svg-study</a>
          </li>
        
          <li>
            <a href="/2017/12/08/openSSl/">openSSl</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>